{% extends 'SonataAdminBundle:CRUD:base_list.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('bundles/mfbcms/skin/ui.dynatree.css') }}" type="text/css" media="all">
    <link rel="stylesheet" href="{{ asset('bundles/mfbcms/css/admin.css') }}" type="text/css" media="all">
{% endblock%}
{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('/js/jquery.cookie.js') }}" type="text/javascript"></script>
    <script src="{{ asset('bundles/mfbcms/js/jquery.dynatree.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('bundles/mfbcms/js/menu.js') }}" type="text/javascript"></script>
{% endblock%}

{% block list_table %}
    <div id="controls" style="display: none;">
        <a href="#" onclick="addTreeChild()"><img src="/img/onebit/01/PNG/onebit_31.png" class="onebit" /></a>
        <a href="#" onclick="deleteTreeChild()"><img src="/img/onebit/01/PNG/onebit_33.png" class="onebit" /></a>
    </div>
    <div id="spinner">
        <img src="/img/ajax-loader.gif"/>
    </div>

    <div>
        <div class="span5">
            <div id="tree"></div>
        </div>
        <div class="span7">
            <div id="edit">test</div>
        </div>
    </div>

    <script type="text/javascript">
        var treeAddUrl = "{{ admin.generateUrl('ajax_add') }}";
        var treeDeleteUrl = "{{ admin.generateUrl('ajax_delete') }}";
        var treeSaveUrl = "{{ admin.generateUrl('ajax_save') }}";
        var treeListUrl = "{{ admin.generateUrl('ajax_tree') }}";

        $("#tree").dynatree({
            persist: true,
            checkbox: true,
            minExpandLevel: 3,
            selectMode: 2,
            onPostInit: function(isReloading, isError) {
                this.reactivate();
                loading(false)
            },
            onActivate: function(node) {
                var isInitializing = node.tree.isInitializing(); // Tree loading phase
                var isReloading = node.tree.isReloading(); // Loading phase, and reading status from cookies
                var isUserEvent = node.tree.isUserEvent(); // Event was triggered by mouse or keyboard
            },
            postProcess: function(data, dataType) {
                loading(true)
            },
            onSelect: function(flag, dtnode) {
                selectNode(flag, dtnode)
            },
            initAjax: {url: treeListUrl}
        });
    </script>
{% endblock %}
